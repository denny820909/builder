{%- block doctype -%}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
{% endblock %}
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    {% block head %}
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    {% if metatags %}
      {{ metatags }}
    {% endif %}
    {% if refresh %}
      <meta http-equiv="refresh" content="{{ refresh|e }}"/>
    {% endif %}
    <title>{{ pageTitle|e }}</title>
    <link rel="stylesheet" href="{{ stylesheet }}" type="text/css" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="{{ path_to_root }}rss">
    <link rel="shortcut icon" href="{{ path_to_root }}favicon.ico">
    {% endblock %}
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript">
    if (typeof String.prototype.endsWith != 'function') {
        String.prototype.endsWith = function(suffix) {
        return this.indexOf(suffix, this.length - suffix.length) !== -1;
    };
    }
    if (typeof String.prototype.startsWith != 'function') {
      String.prototype.startsWith = function (str){
      return this.indexOf(str) == 0;
        };
    }


    function setRepoBranch(schname) {
        console.log(schname);
        var repodict = new Object();
        $("input").each(function (i) {
            if (($(this).attr('name').startsWith("repo_triggerer")))
            {
                var name=$(this).attr('name').replace("repo_triggerer_", "").replace("_"+schname, "");
                repodict[name+"_repo"]=$(this).val();
            };
            if (($(this).attr('name').startsWith("branch_triggerer")))
            {
                var name=$(this).attr('name').replace("branch_triggerer_", "").replace("_"+schname, "");
                repodict[name+"_branch"]=$(this).val();
            };
            if (($(this).attr('name').startsWith("bb_triggerer")))
            {
                var name=$(this).attr('name').replace("bb_triggerer_", "").replace("_"+schname, "");
                repodict[name+"_bb"]=$(this).val();
            };
        });
        console.log(repodict)
        $("input").each(function (i) {

            if (($(this).attr('name').startsWith("repo_trigger_")))
            {

                for (var val in repodict) {
                    if (val.endsWith("_repo")) {
                        console.log(repodict)
                        if ($(this).attr('name').indexOf(val.replace("_repo", "")) != -1 )
                        {
                            $(this).attr("value",repodict[val])
                        };
                    };
                };
            };
            if (($(this).attr('name').startsWith("branch_trigger_")))
            {
                for (var val in repodict) {
                    if (val.endsWith("_branch")) {
                        console.log(repodict)
                        if ($(this).attr('name').indexOf(val.replace("_branch", "")) != -1 )
                        {
                            $(this).attr("value",repodict[val])
                        };
                    };
                };
            };
            if (($(this).attr('name').startsWith("bb_trigger_")))
            {
                for (var val in repodict) {
                    if (val.endsWith("_bb")) {
                        console.log(repodict)
                        if ($(this).attr('name').indexOf(val.replace("_bb", "")) != -1 )
                        {
                            $(this).attr("value",repodict[val])
                        };
                    };
                };
            };
        });
    };

    $(document).ready(function() {
      $(".force-text").hide();
      $(".force-list").hide();
      $(".force-textarea").hide();
      $(".force-any").hide();
      $(".trigger_heading").click(
      function()
      {
        var x = $(this).attr('id')
      $(".force-text").each(function (i) {
            if (($(this).attr('id').endsWith(x))) 
            {
                $(this).toggle()
            };
             });
      $(".force-textarea").each(function (i) {
            if (($(this).attr('id').endsWith(x))) 
            {
                $(this).toggle()
            };
             });
      $(".force-any").each(function (i) {
            if (($(this).attr('id').endsWith(x))) 
            {
                $(this).toggle()
            };
             });
      $(".force-list").each(function (i) {
            if (($(this).attr('id').endsWith(x))) 
            {
                $(this).toggle()
            };
             });

    });
    });
    </script>
    <style type="text/css"> 
        .trigger_heading {
        margin: 1px;
        color: #fff;
        padding: 3px 10px;
        cursor: pointer;
        background-color:#c30;
        }
        .force-text {
        background-color:#fafafa;
        display: none
        }
        .force-textarea {
        background-color:#fafafa;
        display: none
        }
        .force-any {
        background-color:#fafafa;
        display: none
        }
        p { padding: 5px 0; }
    </style>
  </head>
  <body class="interface">
    {% block header -%}
    <div class="header">    
        <a href="{{ path_to_root or '.' }}">Home</a>
        - <a href="{{ path_to_root }}waterfall">Waterfall</a>
        <a href="{{ path_to_root }}grid">Grid</a>
        <a href="{{ path_to_root }}tgrid">T-Grid</a>
        <a href="{{ path_to_root }}console">Console</a>
        <a href="{{ path_to_root }}builders">Builders</a>
        <a href="{{ path_to_root }}one_line_per_build">Recent Builds</a>
        <a href="{{ path_to_root }}buildslaves">Buildslaves</a>
        <a href="{{ path_to_root }}changes">Changesources</a>
        {% if authz.advertiseAction('showUsersPage', request) %}
          <a href="{{ path_to_root }}users">Users</a>
        {% endif %}
        - <a href="{{ path_to_root }}json/help">JSON API</a>
        - <a href="{{ path_to_root }}about">About</a>
    <div class="auth">    
    {% if authz.authenticated(request) %}
    {{ authz.getUsernameHTML(request) }}
    |<a href="{{ path_to_root }}logout">Logout</a>
    {% elif authz.useHttpHeader and authz.httpLoginUrl %}
    <a href="{{ authz.httpLoginUrl }}">Login</a>
    {% elif authz.auth %}
    <form method="post" name="login" action="{{ path_to_root }}login">
    <input type="text" name="username" size=10 />
    <input type="password" name="passwd" size=10 />
    <input type="submit" value="login" />
    </form>
    {% endif %}
    </div>
    </div>
    {% endblock %}

    {%- block barecontent -%}
    <hr/>
    
    {% if alert_msg != "" %}
    <div class="alert">    
    {{ alert_msg }}
    </div>
    {% endif %}

    <div class="content">
      {%- block content -%}     
      {%- endblock -%}
    </div>
    {%- endblock -%}

    {%- block footer -%} 
    <div class="footer" style="clear:both">
      <hr/>
      <a href="http://buildbot.net/">BuildBot</a> ({{version}})
      {% if title -%}
        working for the&nbsp;
        {%- if title_url -%}
          <a href="{{ title_url }}">{{ title }}</a>
        {%- else -%}
          {{ title }}
        {%- endif -%}
        &nbsp;project.
      {%- endif -%}
      <br/>
      Page built: <b>{{ time }}</b> ({{ tz }})
    </div>
    {% endblock -%}
  </body>
</html>
